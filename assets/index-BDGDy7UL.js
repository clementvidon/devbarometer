import{j as o,R as H,L as q,C as $,X as G,Y as X,T as Y,a as U,r as i,c as z}from"./vendor-uy8bHOC1.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();function I(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function K(){I(),window.addEventListener("resize",I)}const V="_chartContainer_pk6j8_1",W="_heading_pk6j8_17",J="_chart_pk6j8_1",Q="_chartFooter_pk6j8_40",Z="_legendCol_pk6j8_58",ee="_controlCol_pk6j8_59",te="_legendItem_pk6j8_71",re="_controlItem_pk6j8_72",ne="_colorDot_pk6j8_96",m={chartContainer:V,heading:W,chart:J,chartFooter:Q,legendCol:Z,controlCol:ee,legendItem:te,controlItem:re,colorDot:ne};function oe({view:t,onToggleView:n,hudVisible:e,onToggleHud:a}){return o.jsxs("div",{className:m.controlCol,children:[o.jsx("button",{type:"button",className:m.controlItem,onClick:n,children:t==="emotions"?"Voir tonalités 📈":"Voir émotions 📊"}),o.jsx("button",{type:"button",className:m.controlItem,"aria-pressed":e,onClick:a,title:e?"Masquer axes/valeurs":"Afficher axes/valeurs",children:e?"Masquer axes/valeurs ⚙️":"Afficher axes/valeurs ⚙️"}),o.jsx("button",{type:"button",className:m.controlItem,disabled:!0,title:"Rapport périodique — bientôt disponible",children:"S'abonner au rapport 📦"})]})}const p={axisText:"#9ec3ff",axisLine:"#6b93c9",grid:"#2a4566",tooltipBg:"rgba(18, 34, 52, 0.96)",tooltipBorder:"#3a5f8f",tooltipText:"#dbeaff"},D={joy:"#B7C8FF",trust:"#B39EFF",fear:"#D00000",anger:"#D20054",disgust:"#7E0000",sadness:"#8B1F4D"},N=Object.keys(D),F={joy:"Joie",trust:"Confiance",fear:"Peur",anger:"Colère",disgust:"Dégoût",sadness:"Tristesse"},A={polarity:"#FF3385",surprise:"#EA80FF",anticipation:"#7728FF"},T=Object.keys(A),O={polarity:"Valence",surprise:"Surprise",anticipation:"Anticipation"},se=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),R=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),S=new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2});function M({data:t,hudVisible:n,tooltipActive:e,setTooltipActive:a,series:s}){return o.jsx("div",{className:m.chart,onPointerDown:()=>a(!0),onPointerUp:()=>a(!1),onPointerCancel:()=>a(!1),onPointerLeave:()=>a(!1),children:o.jsx(H,{width:"100%",height:"100%",children:o.jsxs(q,{data:t,children:[n&&o.jsx($,{stroke:p.grid,strokeDasharray:"3 3",vertical:!1}),o.jsx(G,{dataKey:"createdAt",hide:!n,tick:{fill:p.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:p.axisLine},tickLine:{stroke:p.axisLine},tickFormatter:r=>se.format(new Date(r)),tickMargin:10}),o.jsx(X,{tickFormatter:r=>S.format(r),tickMargin:5,width:50,hide:!n,tick:{fill:p.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:p.axisLine},tickLine:{stroke:p.axisLine},domain:["dataMin","dataMax"]}),o.jsx(Y,{contentStyle:{backgroundColor:p.tooltipBg,border:`1px solid ${p.tooltipBorder}`,borderRadius:8},labelStyle:{color:p.tooltipText},itemStyle:{color:p.tooltipText},cursor:{stroke:p.axisLine,strokeDasharray:"3 3"},wrapperStyle:{display:e?"block":"none"},labelFormatter:r=>R.format(new Date(String(r))),formatter:(r,c)=>[S.format(r),c],itemSorter:r=>typeof r.value=="number"?-r.value:0}),s.map(r=>o.jsx(U,{type:"monotone",dataKey:r.key,stroke:r.color,strokeWidth:3,dot:!1,name:r.label??r.key,activeDot:e?{r:5}:!1},r.key))]})})})}function ae(t){const n=N.map(e=>({key:e,color:D[e],label:F[e]}));return o.jsx(M,{...t,series:n})}function ie({mode:t="emotions"}){const n=t==="emotions"?N.map(e=>({key:String(e),color:D[e],label:F[e]})):T.map(e=>({key:String(e),color:A[e],label:O[e]}));return o.jsx("div",{className:m.legendCol,children:n.map(e=>o.jsxs("div",{className:m.legendItem,children:[o.jsx("span",{className:m.colorDot,style:{backgroundColor:e.color}}),o.jsx("span",{children:e.label})]},e.key))})}function ce(t){const n=T.map(e=>({key:e,color:A[e],label:O[e]}));return o.jsx(M,{...t,series:n})}function le(t){if(!t||typeof t!="object")return!1;const n=t;return typeof n.createdAt=="string"&&typeof n.emotions=="object"&&n.emotions!==null}function ue(t){if(!Array.isArray(t)||!t.every(le))throw new Error("Invalid chart.json shape")}function de(t){const n=Object.keys(D);return t.slice().sort((e,a)=>+new Date(e.createdAt)-+new Date(a.createdAt)).map(e=>{const a={};for(const s of n)a[s]=+(e.emotions[s]??0);return{dateLabel:R.format(new Date(e.createdAt)),createdAt:e.createdAt,...a}})}function fe(t){return t.slice().sort((n,e)=>+new Date(n.createdAt)-+new Date(e.createdAt)).map(n=>{const e=n.tonalities,a=(e==null?void 0:e.positive)??0,s=(e==null?void 0:e.negative)??0,r=(e==null?void 0:e.positive_surprise)??0,c=(e==null?void 0:e.negative_surprise)??0,u=(e==null?void 0:e.optimistic_anticipation)??0,h=(e==null?void 0:e.pessimistic_anticipation)??0;return{createdAt:n.createdAt,polarity:+(a-s),surprise:+(r-c),anticipation:+(u-h)}})}function pe(){const[t,n]=i.useState(null),[e,a]=i.useState(null),[s,r]=i.useState(null);return i.useEffect(()=>{(async()=>{try{const u=await(await fetch("chart.json")).json();ue(u),n(de(u)),a(fe(u))}catch(c){r(c instanceof Error?c:new Error("Erreur inconnue")),n([]),a([])}})()},[]),{emotionData:t,tonalityData:e,isLoading:!t||!e,error:s}}function me(){const{emotionData:t,tonalityData:n,isLoading:e,error:a}=pe(),[s,r]=i.useState("emotions"),[c,u]=i.useState(!1),[h,g]=i.useState(!1);if(e)return o.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du graphique…"});if(!t||!n)return o.jsx("p",{role:"alert","aria-live":"assertive",children:"Données manquantes ou invalides."});if(a)return o.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du graphique."});const x=(t==null?void 0:t.length)??0,j=()=>r(d=>d==="emotions"?"tonalities":"emotions");return o.jsxs("div",{className:m.chartContainer,children:[o.jsx("p",{className:m.heading,children:s==="emotions"?`Intensité des émotions – ${x} jours`:`Polarité des tonalités – ${x} jours`}),s==="emotions"?o.jsx(ae,{data:t,hudVisible:c,tooltipActive:h,setTooltipActive:g}):o.jsx(ce,{data:n,hudVisible:c,tooltipActive:h,setTooltipActive:g}),o.jsxs("div",{className:m.chartFooter,children:[o.jsx("div",{children:o.jsx(ie,{mode:s})}),o.jsx(oe,{view:s,onToggleView:j,hudVisible:c,onToggleHud:()=>u(d=>!d)})]})]})}const he="_report_149pe_1",ge="_emoji_149pe_9",_e="_text_149pe_15",C={report:he,emoji:ge,text:_e};function xe(){const[t,n]=i.useState(null),[e,a]=i.useState(null);return i.useEffect(()=>{fetch("/devbarometer/"+"report.json").then(r=>r.ok?r.json():null).then(r=>{if(r&&typeof r=="object")n(r);else throw new Error("Format de données invalide")}).catch(r=>{a(r instanceof Error?r:new Error("Erreur inconnue")),n(null)})},[]),{report:t,isLoading:t===null&&e===null,error:e}}function je(){const{report:t,isLoading:n,error:e}=xe();return n?o.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du rapport…"}):e||!t?o.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du rapport."}):o.jsxs("div",{className:C.report,children:[o.jsx("div",{className:C.emoji,children:t.emoji}),o.jsx("p",{className:C.text,children:t.text})]})}const ye="_ticker_17ch7_1",ve="_track_17ch7_20",Ee="_dragging_17ch7_33",Le="_row_17ch7_37",De="_noAnim_17ch7_44",be="_item_17ch7_49",y={ticker:ye,track:ve,dragging:Ee,row:Le,noAnim:De,item:be};function ke(t){return typeof t=="object"&&t!==null&&"title"in t&&"weight"in t&&"source"in t&&typeof t.title=="string"&&typeof t.weight=="number"&&typeof t.source=="string"}function Ce(t){const n=t.slice();for(let e=n.length-1;e>0;e--){const a=Math.floor(Math.random()*(e+1));[n[e],n[a]]=[n[a],n[e]]}return n}function we(){const[t,n]=i.useState(null),[e,a]=i.useState(null);return i.useEffect(()=>{fetch("/devbarometer/"+"ticker.json").then(r=>r.ok?r.json():[]).then(r=>{if(Array.isArray(r)&&r.every(ke))n(Ce(r));else throw new Error("Format de données invalide")}).catch(r=>{a(r instanceof Error?r:new Error("Erreur inconnue")),n([])})},[]),{headlines:t,isLoading:t===null&&e===null,error:e}}function Ae(t,n,{copies:e}){const c=i.useRef(!1),u=i.useRef(!1),h=i.useRef(!1),g=i.useRef(!1),x=i.useRef(0),j=i.useRef(0),d=()=>{const l=t.current,f=n.current;if(!l||!f)return;const k=f.scrollWidth/e;l.scrollLeft<24?l.scrollLeft+=k:l.scrollLeft>k*2-24&&(l.scrollLeft-=k)},v=l=>{l.scrollLeft+=.01,l.scrollLeft-=.01},E=i.useCallback(()=>{const l=t.current,f=n.current;if(!l||!f)return;const _=requestAnimationFrame(()=>{l.scrollLeft=f.scrollWidth/e});return()=>cancelAnimationFrame(_)},[e]),b=i.useCallback(l=>{l.preventDefault();const f=t.current;if(!f)return;c.current=!0,u.current=!1,h.current=!1,x.current=l.clientX,j.current=f.scrollLeft,f.classList.add(y.dragging);const _=()=>{c.current=!1,u.current=!1,f.classList.remove(y.dragging),d(),v(f),g.current=!1,window.removeEventListener("pointerup",_)};window.addEventListener("pointerup",_)},[t,n]),P=i.useCallback(l=>{const f=t.current;if(!f||!c.current)return;const _=l.clientX-x.current;!u.current&&Math.abs(_)>10&&(u.current=!0,h.current=!0,g.current=!0),u.current&&(f.scrollLeft=j.current-_,d(),l.preventDefault())},[t,n]),B=i.useCallback(l=>{h.current&&(l.preventDefault(),l.stopPropagation())},[]);return{onPointerDown:b,onPointerMove:P,onClickCapture:B,hasDraggedOnce:g,placeInitialScroll:E}}const w=3;function Ie(){const{headlines:t,isLoading:n,error:e}=we(),a=i.useRef(null),s=i.useRef(null),r=i.useMemo(()=>t??[],[t]),c=i.useMemo(()=>Array.from({length:w},()=>r).flat(),[r]),{onPointerDown:u,onPointerMove:h,onClickCapture:g,hasDraggedOnce:x,placeInitialScroll:j}=Ae(a,s,{copies:w});return i.useEffect(()=>{const d=a.current,v=s.current;if(!d||!v)return;const E=v.scrollWidth/w;Math.abs(d.scrollLeft-E)>2&&(d.scrollLeft=E)},[c.length]),i.useEffect(()=>{j()},[c.length,j]),n?o.jsx("p",{role:"status","aria-live":"polite",children:"Chargement des titres…"}):e||!c.length?o.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement des titres."}):o.jsx("div",{className:y.ticker,onPointerDown:u,onPointerMove:h,onClickCapture:g,children:o.jsx("div",{ref:a,className:y.track,children:o.jsx("div",{ref:s,className:`${y.row} ${x.current?y.noAnim:""}`,children:c.map(({title:d,source:v,weight:E},b)=>o.jsxs("a",{href:v,target:"_blank",rel:"noopener noreferrer",className:y.item,"aria-label":`Source: ${d}`,title:d,draggable:!1,children:["«",d,"» ⇧",E]},b))})})})}const Se="_navButton_1c8qa_1",Ne="_heading_1c8qa_12",Fe="_mainContent_1c8qa_23",Te="_footer_1c8qa_33",L={navButton:Se,heading:Ne,mainContent:Fe,footer:Te};function Oe(){return o.jsxs(o.Fragment,{children:[o.jsxs("header",{className:L.header,children:[o.jsx("h1",{className:L.heading,children:"DevBarometer"}),o.jsx("a",{className:L.navButton,href:"https://github.com/clementvidon/devbarometer","aria-label":"Infos page",target:"_blank",rel:"noopener noreferrer",children:"à propos"})]}),o.jsxs("main",{className:L.mainContent,children:[o.jsx(je,{}),o.jsx(Ie,{}),o.jsx(me,{})]}),o.jsxs("footer",{className:L.footer,children:["Made with ❤️ by",o.jsx("a",{href:"https://github.com/clementvidon/","aria-label":"Author's GitHub",target:"_blank",rel:"noopener noreferrer",children:" Clément Vidon "}),"· MIT License"]})]})}K();z.createRoot(document.getElementById("root")).render(o.jsx(i.StrictMode,{children:o.jsx(Oe,{})}));
