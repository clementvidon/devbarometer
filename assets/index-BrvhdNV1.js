import{j as s,R as Y,L as z,C as V,X as J,Y as Q,T as Z,a as ee,o as T,n as h,e as te,s as S,r as l,c as re}from"./vendor-DiRRkWsw.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(a){if(a.ep)return;a.ep=!0;const t=e(a);fetch(a.href,t)}})();const ne="_chartContainer_pk6j8_1",oe="_heading_pk6j8_17",se="_chart_pk6j8_1",ae="_chartFooter_pk6j8_40",ie="_legendCol_pk6j8_58",ce="_controlCol_pk6j8_59",le="_legendItem_pk6j8_71",ue="_controlItem_pk6j8_72",de="_colorDot_pk6j8_96",j={chartContainer:ne,heading:oe,chart:se,chartFooter:ae,legendCol:ie,controlCol:ce,legendItem:le,controlItem:ue,colorDot:de};function me({view:r,onToggleView:n,hudVisible:e,onToggleHud:o}){return s.jsxs("div",{className:j.controlCol,children:[s.jsx("button",{type:"button",className:j.controlItem,onClick:n,children:r==="emotions"?"Voir tonalités 📈":"Voir émotions 📊"}),s.jsx("button",{type:"button",className:j.controlItem,"aria-pressed":e,onClick:o,title:e?"Masquer axes/valeurs":"Afficher axes/valeurs",children:e?"Masquer axes/valeurs ⚙️":"Afficher axes/valeurs ⚙️"}),s.jsx("button",{type:"button",className:j.controlItem,disabled:!0,title:"Rapport périodique — bientôt disponible",children:"S'abonner au rapport 📦"}),s.jsx("button",{type:"button",className:j.controlItem,disabled:!0,title:"Analyste interactif — bientôt disponible",children:"Parler à l'analyste 💬"})]})}const _={axisText:"#9ec3ff",axisLine:"#6b93c9",grid:"#2a4566",tooltipBg:"rgba(18, 34, 52, 0.96)",tooltipBorder:"#3a5f8f",tooltipText:"#dbeaff"},A={joy:"#B7C8FF",trust:"#B39EFF",fear:"#D00000",anger:"#D20054",disgust:"#7E0000",sadness:"#8B1F4D"},P=Object.keys(A),G={joy:"Joie",trust:"Confiance",fear:"Peur",anger:"Colère",disgust:"Dégoût",sadness:"Tristesse"},R={polarity:"#FF3385",surprise:"#EA80FF",anticipation:"#7728FF"},q=Object.keys(R),K={polarity:"Valence",surprise:"Surprise",anticipation:"Anticipation"},fe=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),U=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"}),H=new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2});function X({data:r,hudVisible:n,tooltipActive:e,setTooltipActive:o,series:a}){return s.jsx("div",{className:j.chart,onPointerDown:()=>o(!0),onPointerUp:()=>o(!1),onPointerCancel:()=>o(!1),onPointerLeave:()=>o(!1),children:s.jsx(Y,{width:"100%",height:"100%",children:s.jsxs(z,{data:r,children:[n&&s.jsx(V,{stroke:_.grid,strokeDasharray:"3 3",vertical:!1}),s.jsx(J,{dataKey:"createdAt",hide:!n,tick:{fill:_.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:_.axisLine},tickLine:{stroke:_.axisLine},tickFormatter:t=>fe.format(new Date(t)),tickMargin:10}),s.jsx(Q,{tickFormatter:t=>H.format(t),tickMargin:5,width:50,hide:!n,tick:{fill:_.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:_.axisLine},tickLine:{stroke:_.axisLine},domain:["dataMin","dataMax"]}),s.jsx(Z,{contentStyle:{backgroundColor:_.tooltipBg,border:`1px solid ${_.tooltipBorder}`,borderRadius:8},labelStyle:{color:_.tooltipText},itemStyle:{color:_.tooltipText},cursor:{stroke:_.axisLine,strokeDasharray:"3 3"},wrapperStyle:{display:e?"block":"none"},labelFormatter:t=>U.format(new Date(String(t))),formatter:(t,i)=>[H.format(t),i],itemSorter:t=>typeof t.value=="number"?-t.value:0}),a.map(t=>s.jsx(ee,{type:"monotone",dataKey:t.key,stroke:t.color,strokeWidth:3,dot:!1,name:t.label??t.key,activeDot:e?{r:5}:!1},t.key))]})})})}function pe(r){const n=P.map(e=>({key:e,color:A[e],label:G[e]}));return s.jsx(X,{...r,series:n})}function he({mode:r="emotions"}){const n=r==="emotions"?P.map(e=>({key:String(e),color:A[e],label:G[e]})):q.map(e=>({key:String(e),color:R[e],label:K[e]}));return s.jsx("div",{className:j.legendCol,children:n.map(e=>s.jsxs("div",{className:j.legendItem,children:[s.jsx("span",{className:j.colorDot,style:{backgroundColor:e.color}}),s.jsx("span",{children:e.label})]},e.key))})}function ge(r){const n=q.map(e=>({key:e,color:R[e],label:K[e]}));return s.jsx(X,{...r,series:n})}const xe=T({joy:h().min(0).max(1),trust:h().min(0).max(1),anger:h().min(0).max(1),fear:h().min(0).max(1),sadness:h().min(0).max(1),disgust:h().min(0).max(1)}),_e=T({positive:h().min(0).max(1),negative:h().min(0).max(1),positive_surprise:h().min(0).max(1),negative_surprise:h().min(0).max(1),optimistic_anticipation:h().min(0).max(1),pessimistic_anticipation:h().min(0).max(1)}),je=["☀️","🌤️","⛅","🌥️","☁️","🌦️","🌧️","⛈️","❄️","🌩️"],ye=te(je);T({text:S().max(200),emoji:ye});const ve=S().datetime({offset:!0}),be=T({createdAt:ve,count:h().int().nonnegative(),totalWeight:h().nonnegative(),emotions:xe,tonalities:_e}),Ee=T({title:S(),weight:S(),source:S()}),ke={detail:{K:8,passes:1,anchors:8},custom:{K:8,passes:2,anchors:10},clean:{K:5,passes:2,anchors:7},narrative:{K:3,passes:2,anchors:6}};function Le(r){const n=1-Math.pow(2,-1/Math.max(r,1e-6));return Math.min(.95,Math.max(.02,n))}function De(r,n,e){const o={};return r.map((a,t)=>{const i={...a};for(const c of n){const u=a[c];if(typeof u!="number")continue;const m=t===0?u:e*u+(1-e)*(o[c]??u);i[c]=m,o[c]=m}return i})}function we(r,n){const e=r.length,o=Array.from({length:e-1},(i,c)=>r[c+1]-r[c]),a=Array.from({length:e-1},(i,c)=>(n[c+1]-n[c])/o[c]),t=new Array(e);t[0]=a[0],t[e-1]=a[e-2];for(let i=1;i<e-1;i++)if(a[i-1]*a[i]<=0)t[i]=0;else{const c=2*o[i]+o[i-1],u=o[i]+2*o[i-1];t[i]=(c+u)/(c/a[i-1]+u/a[i])}return i=>{let c=r.findIndex((I,N)=>i>=I&&i<=r[N+1]);c<0&&(c=e-2);const u=(i-r[c])/o[c],m=n[c],d=n[c+1],b=t[c],y=t[c+1],v=u*u,g=v*u,x=2*g-3*v+1,E=g-2*v+u,k=-2*g+3*v,w=g-v;return x*m+E*o[c]*b+k*d+w*o[c]*y}}function Ce(r,n,e){const o=r.length;if(o<=e)return[...r];const a=r.map((c,u)=>u),t=Array.from({length:e},(c,u)=>Math.round(u*(o-1)/(e-1))),i=r.map(c=>({...c}));for(const c of n){const u=r.map(d=>typeof d[c]=="number"?d[c]:0),m=we(t,t.map(d=>u[d]));for(let d=0;d<o;d++)i[d][c]=m(a[d])}return i}function B(r,n,e="clean"){const o=r.length;if(o<=2)return[...r];const{K:a,passes:t,anchors:i}=ke[e],c=Le(Math.max(2,o/a));let u=[...r];for(let d=0;d<t;d++)u=De(u,n,c);const m=Math.min(Math.max(3,i),o);return m<o?Ce(u,n,m):u}function Se(r){const n=Object.keys(A);return r.slice().sort((e,o)=>+new Date(e.createdAt)-+new Date(o.createdAt)).map(({createdAt:e,emotions:o})=>{const a={};for(const t of n)a[t]=+(o[t]??0);return{dateLabel:U.format(new Date(e)),createdAt:e,...a}})}function Te(r){return r.slice().sort((n,e)=>+new Date(n.createdAt)-+new Date(e.createdAt)).map(({createdAt:n,tonalities:e})=>({createdAt:n,polarity:+(e.positive-e.negative),surprise:+(e.positive_surprise-e.negative_surprise),anticipation:+(e.optimistic_anticipation-e.pessimistic_anticipation)}))}function Ae(){const[r,n]=l.useState(null),[e,o]=l.useState(null),[a,t]=l.useState(null);return l.useEffect(()=>{(async()=>{try{const c=await fetch("/devbarometer/"+"chart.json"),u=be.array().parse(await c.json());n(B(Se(u),P,"custom")),o(B(Te(u),q,"custom"))}catch(i){t(i instanceof Error?i:new Error("Erreur inconnue")),n([]),o([])}})()},[]),{emotionData:r,tonalityData:e,isLoading:!r||!e,error:a}}function Ie(){const{emotionData:r,tonalityData:n,isLoading:e,error:o}=Ae(),[a,t]=l.useState("emotions"),[i,c]=l.useState(!1),[u,m]=l.useState(!1);if(e)return s.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du graphique…"});if(!r||!n)return s.jsx("p",{role:"alert","aria-live":"assertive",children:"Données manquantes ou invalides."});if(o)return s.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du graphique."});const d=(r==null?void 0:r.length)??0,b=()=>t(y=>y==="emotions"?"tonalities":"emotions");return s.jsxs("div",{className:j.chartContainer,children:[s.jsx("p",{className:j.heading,children:a==="emotions"?`Intensité des émotions – ${d} jours`:`Polarité des tonalités – ${d} jours`}),a==="emotions"?s.jsx(pe,{data:r,hudVisible:i,tooltipActive:u,setTooltipActive:m}):s.jsx(ge,{data:n,hudVisible:i,tooltipActive:u,setTooltipActive:m}),s.jsxs("div",{className:j.chartFooter,children:[s.jsx("div",{children:s.jsx(he,{mode:a})}),s.jsx(me,{view:a,onToggleView:b,hudVisible:i,onToggleHud:()=>c(y=>!y)})]})]})}const Ne="_report_149pe_1",Fe="_emoji_149pe_9",Me="_text_149pe_15",M={report:Ne,emoji:Fe,text:Me};function Oe(){const[r,n]=l.useState(null),[e,o]=l.useState(null);return l.useEffect(()=>{fetch("/devbarometer/"+"report.json").then(t=>t.ok?t.json():null).then(t=>{if(t&&typeof t=="object")n(t);else throw new Error("Format de données invalide")}).catch(t=>{o(t instanceof Error?t:new Error("Erreur inconnue")),n(null)})},[]),{report:r,isLoading:r===null&&e===null,error:e}}function Pe(){const{report:r,isLoading:n,error:e}=Oe();return n?s.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du rapport…"}):e||!r?s.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du rapport."}):s.jsxs("div",{className:M.report,children:[s.jsx("div",{className:M.emoji,children:r.emoji}),s.jsx("p",{className:M.text,children:r.text})]})}const Re="_ticker_ycql9_1",qe="_track_ycql9_20",He="_dragging_ycql9_33",Be="_row_ycql9_37",$e="_paused_ycql9_44",Ge="_item_ycql9_48",D={ticker:Re,track:qe,dragging:He,row:Be,paused:$e,item:Ge};function Ke(r){const n=r.slice();for(let e=n.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[n[e],n[o]]=[n[o],n[e]]}return n}function Ue(){const[r,n]=l.useState(null),[e,o]=l.useState(null);return l.useEffect(()=>{(async()=>{try{const t=await fetch("/devbarometer/"+"ticker.json");if(!t.ok){n([]);return}const i=await t.json(),c=Ee.array().safeParse(i);if(!c.success){o(new Error(c.error.message)),n([]);return}n(Ke(c.data))}catch(a){o(a instanceof Error?a:new Error("Erreur inconnue")),n([])}})()},[]),{headlines:r,isLoading:r===null&&e===null,error:e}}function Xe(r,n,{copies:e,onPause:o,onResume:a,pauseDelay:t=120}){const m=l.useRef(!1),d=l.useRef(!1),b=l.useRef(!1),y=l.useRef(0),v=l.useRef(0),g=l.useRef(null),x=()=>{const f=r.current,p=n.current;if(!f||!p)return;const F=p.scrollWidth/e;f.scrollLeft<24?f.scrollLeft+=F:f.scrollLeft>F*2-24&&(f.scrollLeft-=F)},E=f=>{f.scrollLeft+=.01,f.scrollLeft-=.01},k=l.useCallback(()=>{const f=r.current,p=n.current;if(!f||!p)return;const L=requestAnimationFrame(()=>{f.scrollLeft=p.scrollWidth/e});return()=>cancelAnimationFrame(L)},[e]),w=()=>{g.current!==null&&(window.clearTimeout(g.current),g.current=null)},I=l.useCallback(f=>{const p=r.current;if(!p)return;m.current=!0,d.current=!1,b.current=!1,y.current=f.clientX,v.current=p.scrollLeft,p.classList.add(D.dragging),w(),g.current=window.setTimeout(()=>{m.current&&!d.current&&o()},t);const L=()=>{m.current=!1,p.classList.remove(D.dragging),w(),x(),E(p),a(),window.removeEventListener("pointerup",L)};window.addEventListener("pointerup",L)},[r,o,a,t]),N=l.useCallback(f=>{const p=r.current;if(!p||!m.current)return;const L=f.clientX-y.current;!d.current&&Math.abs(L)>10&&(d.current=!0,b.current=!0,w(),o()),d.current&&(p.scrollLeft=v.current-L,x(),f.preventDefault())},[r,o]),W=l.useCallback(f=>{b.current&&(f.preventDefault(),f.stopPropagation())},[]);return{onPointerDown:I,onPointerMove:N,onClickCapture:W,placeInitialScroll:k}}const O=3;function We(){const{headlines:r,isLoading:n,error:e}=Ue(),o=l.useRef(null),a=l.useRef(null),t=l.useMemo(()=>r??[],[r]),i=l.useMemo(()=>Array.from({length:O},()=>t).flat(),[t]),[c,u]=l.useState(!1),m=l.useCallback(()=>u(!0),[]),d=l.useCallback(()=>u(!1),[]),{onPointerDown:b,onPointerMove:y,onClickCapture:v,placeInitialScroll:g}=Xe(o,a,{copies:O,onPause:m,onResume:d,pauseDelay:120});return l.useEffect(()=>{const x=o.current,E=a.current;if(!x||!E)return;const k=E.scrollWidth/O;Math.abs(x.scrollLeft-k)>2&&(x.scrollLeft=k)},[i.length]),l.useEffect(()=>g(),[i.length,g]),n?s.jsx("p",{role:"status","aria-live":"polite",children:"Chargement des titres…"}):e?s.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement."}):i.length?s.jsx("div",{className:D.ticker,onPointerDown:b,onPointerMove:y,onClickCapture:v,children:s.jsx("div",{ref:o,className:D.track,children:s.jsx("div",{ref:a,className:`${D.row} ${c?D.paused:""}`,children:i.map(({title:x,source:E},k)=>s.jsxs("a",{href:E,target:"_blank",rel:"noopener noreferrer",className:D.item,"aria-label":`Ouvrir: ${x} (nouvelle fenêtre)`,title:x,draggable:!1,children:["«",x,"»"]},k))})})}):s.jsx("p",{role:"status",children:"Aucun titre disponible."})}function $(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function Ye(){$(),window.addEventListener("resize",$)}const ze="_navButton_1c8qa_1",Ve="_heading_1c8qa_12",Je="_mainContent_1c8qa_23",Qe="_footer_1c8qa_33",C={navButton:ze,heading:Ve,mainContent:Je,footer:Qe};function Ze(){return l.useEffect(()=>{Ye()},[]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:C.header,children:[s.jsx("h1",{className:C.heading,children:"DevBarometer"}),s.jsx("a",{className:C.navButton,href:"https://github.com/clementvidon/devbarometer","aria-label":"Infos page",target:"_blank",rel:"noopener noreferrer",children:"à propos"})]}),s.jsxs("main",{className:C.mainContent,children:[s.jsx(Pe,{}),s.jsx(We,{}),s.jsx(Ie,{})]}),s.jsxs("footer",{className:C.footer,children:["Made with ❤️ by",s.jsx("a",{href:"https://github.com/clementvidon/","aria-label":"Author's GitHub",target:"_blank",rel:"noopener noreferrer",children:" Clément Vidon "})]})]})}re.createRoot(document.getElementById("root")).render(s.jsx(l.StrictMode,{children:s.jsx(Ze,{})}));
