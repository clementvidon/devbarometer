import{j as s,R as X,L as U,C as Y,X as z,Y as W,T as V,a as J,r as u,c as Q}from"./vendor-uy8bHOC1.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();const Z="_chartContainer_pk6j8_1",ee="_heading_pk6j8_17",te="_chart_pk6j8_1",re="_chartFooter_pk6j8_40",ne="_legendCol_pk6j8_58",oe="_controlCol_pk6j8_59",se="_legendItem_pk6j8_71",ae="_controlItem_pk6j8_72",ie="_colorDot_pk6j8_96",x={chartContainer:Z,heading:ee,chart:te,chartFooter:re,legendCol:ne,controlCol:oe,legendItem:se,controlItem:ae,colorDot:ie};function ce({view:t,onToggleView:n,hudVisible:e,onToggleHud:o}){return s.jsxs("div",{className:x.controlCol,children:[s.jsx("button",{type:"button",className:x.controlItem,onClick:n,children:t==="emotions"?"Voir tonalit√©s üìà":"Voir √©motions üìä"}),s.jsx("button",{type:"button",className:x.controlItem,"aria-pressed":e,onClick:o,title:e?"Masquer axes/valeurs":"Afficher axes/valeurs",children:e?"Masquer axes/valeurs ‚öôÔ∏è":"Afficher axes/valeurs ‚öôÔ∏è"}),s.jsx("button",{type:"button",className:x.controlItem,disabled:!0,title:"Rapport p√©riodique ‚Äî bient√¥t disponible",children:"S'abonner au rapport üì¶"}),s.jsx("button",{type:"button",className:x.controlItem,disabled:!0,title:"Analyste interactif ‚Äî bient√¥t disponible",children:"Parler √† l'analyste üí¨"})]})}const _={axisText:"#9ec3ff",axisLine:"#6b93c9",grid:"#2a4566",tooltipBg:"rgba(18, 34, 52, 0.96)",tooltipBorder:"#3a5f8f",tooltipText:"#dbeaff"},C={joy:"#B7C8FF",trust:"#B39EFF",fear:"#D00000",anger:"#D20054",disgust:"#7E0000",sadness:"#8B1F4D"},F=Object.keys(C),B={joy:"Joie",trust:"Confiance",fear:"Peur",anger:"Col√®re",disgust:"D√©go√ªt",sadness:"Tristesse"},M={polarity:"#FF3385",surprise:"#EA80FF",anticipation:"#7728FF"},R=Object.keys(M),H={polarity:"Valence",surprise:"Surprise",anticipation:"Anticipation"},le=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),$=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"}),O=new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2});function G({data:t,hudVisible:n,tooltipActive:e,setTooltipActive:o,series:a}){return s.jsx("div",{className:x.chart,onPointerDown:()=>o(!0),onPointerUp:()=>o(!1),onPointerCancel:()=>o(!1),onPointerLeave:()=>o(!1),children:s.jsx(X,{width:"100%",height:"100%",children:s.jsxs(U,{data:t,children:[n&&s.jsx(Y,{stroke:_.grid,strokeDasharray:"3 3",vertical:!1}),s.jsx(z,{dataKey:"createdAt",hide:!n,tick:{fill:_.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:_.axisLine},tickLine:{stroke:_.axisLine},tickFormatter:r=>le.format(new Date(r)),tickMargin:10}),s.jsx(W,{tickFormatter:r=>O.format(r),tickMargin:5,width:50,hide:!n,tick:{fill:_.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:_.axisLine},tickLine:{stroke:_.axisLine},domain:["dataMin","dataMax"]}),s.jsx(V,{contentStyle:{backgroundColor:_.tooltipBg,border:`1px solid ${_.tooltipBorder}`,borderRadius:8},labelStyle:{color:_.tooltipText},itemStyle:{color:_.tooltipText},cursor:{stroke:_.axisLine,strokeDasharray:"3 3"},wrapperStyle:{display:e?"block":"none"},labelFormatter:r=>$.format(new Date(String(r))),formatter:(r,i)=>[O.format(r),i],itemSorter:r=>typeof r.value=="number"?-r.value:0}),a.map(r=>s.jsx(J,{type:"monotone",dataKey:r.key,stroke:r.color,strokeWidth:3,dot:!1,name:r.label??r.key,activeDot:e?{r:5}:!1},r.key))]})})})}function ue(t){const n=F.map(e=>({key:e,color:C[e],label:B[e]}));return s.jsx(G,{...t,series:n})}function de({mode:t="emotions"}){const n=t==="emotions"?F.map(e=>({key:String(e),color:C[e],label:B[e]})):R.map(e=>({key:String(e),color:M[e],label:H[e]}));return s.jsx("div",{className:x.legendCol,children:n.map(e=>s.jsxs("div",{className:x.legendItem,children:[s.jsx("span",{className:x.colorDot,style:{backgroundColor:e.color}}),s.jsx("span",{children:e.label})]},e.key))})}function fe(t){const n=R.map(e=>({key:e,color:M[e],label:H[e]}));return s.jsx(G,{...t,series:n})}function pe(t){if(!t||typeof t!="object")return!1;const n=t;return typeof n.createdAt=="string"&&typeof n.emotions=="object"&&n.emotions!==null}function me(t){if(!Array.isArray(t)||!t.every(pe))throw new Error("Invalid chart.json shape")}function he(t){const n=Object.keys(C);return t.slice().sort((e,o)=>+new Date(e.createdAt)-+new Date(o.createdAt)).map(e=>{const o={};for(const a of n)o[a]=+(e.emotions[a]??0);return{dateLabel:$.format(new Date(e.createdAt)),createdAt:e.createdAt,...o}})}function ge(t){return t.slice().sort((n,e)=>+new Date(n.createdAt)-+new Date(e.createdAt)).map(n=>{const e=n.tonalities,o=(e==null?void 0:e.positive)??0,a=(e==null?void 0:e.negative)??0,r=(e==null?void 0:e.positive_surprise)??0,i=(e==null?void 0:e.negative_surprise)??0,c=(e==null?void 0:e.optimistic_anticipation)??0,l=(e==null?void 0:e.pessimistic_anticipation)??0;return{createdAt:n.createdAt,polarity:+(o-a),surprise:+(r-i),anticipation:+(c-l)}})}const _e={detail:{K:8,passes:1,anchors:8},custom:{K:8,passes:2,anchors:10},clean:{K:5,passes:2,anchors:7},narrative:{K:3,passes:2,anchors:6}};function xe(t){const n=1-Math.pow(2,-1/Math.max(t,1e-6));return Math.min(.95,Math.max(.02,n))}function ye(t,n,e){const o={};return t.map((a,r)=>{const i={...a};for(const c of n){const l=a[c];if(typeof l!="number")continue;const f=r===0?l:e*l+(1-e)*(o[c]??l);i[c]=f,o[c]=f}return i})}function je(t,n){const e=t.length,o=Array.from({length:e-1},(i,c)=>t[c+1]-t[c]),a=Array.from({length:e-1},(i,c)=>(n[c+1]-n[c])/o[c]),r=new Array(e);r[0]=a[0],r[e-1]=a[e-2];for(let i=1;i<e-1;i++)if(a[i-1]*a[i]<=0)r[i]=0;else{const c=2*o[i]+o[i-1],l=o[i]+2*o[i-1];r[i]=(c+l)/(c/a[i-1]+l/a[i])}return i=>{let c=t.findIndex((D,I)=>i>=D&&i<=t[I+1]);c<0&&(c=e-2);const l=(i-t[c])/o[c],f=n[c],d=n[c+1],v=r[c],y=r[c+1],j=l*l,h=j*l,g=2*h-3*j+1,E=h-2*j+l,b=-2*h+3*j,L=h-j;return g*f+E*o[c]*v+b*d+L*o[c]*y}}function ve(t,n,e){const o=t.length;if(o<=e)return[...t];const a=t.map((c,l)=>l),r=Array.from({length:e},(c,l)=>Math.round(l*(o-1)/(e-1))),i=t.map(c=>({...c}));for(const c of n){const l=t.map(d=>typeof d[c]=="number"?d[c]:0),f=je(r,r.map(d=>l[d]));for(let d=0;d<o;d++)i[d][c]=f(a[d])}return i}function P(t,n,e="clean"){const o=t.length;if(o<=2)return[...t];const{K:a,passes:r,anchors:i}=_e[e],c=xe(Math.max(2,o/a));let l=[...t];for(let d=0;d<r;d++)l=ye(l,n,c);const f=Math.min(Math.max(3,i),o);return f<o?ve(l,n,f):l}function Ee(){const[t,n]=u.useState(null),[e,o]=u.useState(null),[a,r]=u.useState(null);return u.useEffect(()=>{(async()=>{try{const c=await(await fetch("chart.json")).json();me(c);const l=he(c),f=ge(c);n(P(l,F,"custom")),o(P(f,R,"custom"))}catch(i){r(i instanceof Error?i:new Error("Erreur inconnue")),n([]),o([])}})()},[]),{emotionData:t,tonalityData:e,isLoading:!t||!e,error:a}}function be(){const{emotionData:t,tonalityData:n,isLoading:e,error:o}=Ee(),[a,r]=u.useState("emotions"),[i,c]=u.useState(!1),[l,f]=u.useState(!1);if(e)return s.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du graphique‚Ä¶"});if(!t||!n)return s.jsx("p",{role:"alert","aria-live":"assertive",children:"Donn√©es manquantes ou invalides."});if(o)return s.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du graphique."});const d=(t==null?void 0:t.length)??0,v=()=>r(y=>y==="emotions"?"tonalities":"emotions");return s.jsxs("div",{className:x.chartContainer,children:[s.jsx("p",{className:x.heading,children:a==="emotions"?`Intensit√© des √©motions ‚Äì ${d}¬†jours`:`Polarit√© des tonalit√©s ‚Äì ${d}¬†jours`}),a==="emotions"?s.jsx(ue,{data:t,hudVisible:i,tooltipActive:l,setTooltipActive:f}):s.jsx(fe,{data:n,hudVisible:i,tooltipActive:l,setTooltipActive:f}),s.jsxs("div",{className:x.chartFooter,children:[s.jsx("div",{children:s.jsx(de,{mode:a})}),s.jsx(ce,{view:a,onToggleView:v,hudVisible:i,onToggleHud:()=>c(y=>!y)})]})]})}const ke="_report_149pe_1",we="_emoji_149pe_9",Le="_text_149pe_15",S={report:ke,emoji:we,text:Le};function Ae(){const[t,n]=u.useState(null),[e,o]=u.useState(null);return u.useEffect(()=>{fetch("/devbarometer/"+"report.json").then(r=>r.ok?r.json():null).then(r=>{if(r&&typeof r=="object")n(r);else throw new Error("Format de donn√©es invalide")}).catch(r=>{o(r instanceof Error?r:new Error("Erreur inconnue")),n(null)})},[]),{report:t,isLoading:t===null&&e===null,error:e}}function Ce(){const{report:t,isLoading:n,error:e}=Ae();return n?s.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du rapport‚Ä¶"}):e||!t?s.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du rapport."}):s.jsxs("div",{className:S.report,children:[s.jsx("div",{className:S.emoji,children:t.emoji}),s.jsx("p",{className:S.text,children:t.text})]})}const De="_ticker_ycql9_1",Ie="_track_ycql9_20",Ne="_dragging_ycql9_33",Se="_row_ycql9_37",Te="_paused_ycql9_44",Fe="_item_ycql9_48",w={ticker:De,track:Ie,dragging:Ne,row:Se,paused:Te,item:Fe};function Me(t){return typeof t=="object"&&t!==null&&"title"in t&&"weight"in t&&"source"in t&&typeof t.title=="string"&&typeof t.weight=="string"&&typeof t.source=="string"}function Re(t){const n=t.slice();for(let e=n.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[n[e],n[o]]=[n[o],n[e]]}return n}function Oe(){const[t,n]=u.useState(null),[e,o]=u.useState(null);return u.useEffect(()=>{fetch("/devbarometer/"+"ticker.json").then(r=>r.ok?r.json():[]).then(r=>{if(Array.isArray(r)&&r.every(Me))n(Re(r));else throw new Error("Format de donn√©es invalide")}).catch(r=>{o(r instanceof Error?r:new Error("Erreur inconnue")),n([])})},[]),{headlines:t,isLoading:t===null&&e===null,error:e}}function Pe(t,n,{copies:e,onPause:o,onResume:a,pauseDelay:r=120}){const f=u.useRef(!1),d=u.useRef(!1),v=u.useRef(!1),y=u.useRef(0),j=u.useRef(0),h=u.useRef(null),g=()=>{const p=t.current,m=n.current;if(!p||!m)return;const N=m.scrollWidth/e;p.scrollLeft<24?p.scrollLeft+=N:p.scrollLeft>N*2-24&&(p.scrollLeft-=N)},E=p=>{p.scrollLeft+=.01,p.scrollLeft-=.01},b=u.useCallback(()=>{const p=t.current,m=n.current;if(!p||!m)return;const k=requestAnimationFrame(()=>{p.scrollLeft=m.scrollWidth/e});return()=>cancelAnimationFrame(k)},[e]),L=()=>{h.current!==null&&(window.clearTimeout(h.current),h.current=null)},D=u.useCallback(p=>{const m=t.current;if(!m)return;f.current=!0,d.current=!1,v.current=!1,y.current=p.clientX,j.current=m.scrollLeft,m.classList.add(w.dragging),L(),h.current=window.setTimeout(()=>{f.current&&!d.current&&o()},r);const k=()=>{f.current=!1,m.classList.remove(w.dragging),L(),g(),E(m),a(),window.removeEventListener("pointerup",k)};window.addEventListener("pointerup",k)},[t,o,a,r]),I=u.useCallback(p=>{const m=t.current;if(!m||!f.current)return;const k=p.clientX-y.current;!d.current&&Math.abs(k)>10&&(d.current=!0,v.current=!0,L(),o()),d.current&&(m.scrollLeft=j.current-k,g(),p.preventDefault())},[t,o]),K=u.useCallback(p=>{v.current&&(p.preventDefault(),p.stopPropagation())},[]);return{onPointerDown:D,onPointerMove:I,onClickCapture:K,placeInitialScroll:b}}const T=3;function qe(){const{headlines:t,isLoading:n,error:e}=Oe(),o=u.useRef(null),a=u.useRef(null),r=u.useMemo(()=>t??[],[t]),i=u.useMemo(()=>Array.from({length:T},()=>r).flat(),[r]),[c,l]=u.useState(!1),f=u.useCallback(()=>l(!0),[]),d=u.useCallback(()=>l(!1),[]),{onPointerDown:v,onPointerMove:y,onClickCapture:j,placeInitialScroll:h}=Pe(o,a,{copies:T,onPause:f,onResume:d,pauseDelay:120});return u.useEffect(()=>{const g=o.current,E=a.current;if(!g||!E)return;const b=E.scrollWidth/T;Math.abs(g.scrollLeft-b)>2&&(g.scrollLeft=b)},[i.length]),u.useEffect(()=>h(),[i.length,h]),n?s.jsx("p",{role:"status","aria-live":"polite",children:"Chargement des titres‚Ä¶"}):e?s.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement."}):i.length?s.jsx("div",{className:w.ticker,onPointerDown:v,onPointerMove:y,onClickCapture:j,children:s.jsx("div",{ref:o,className:w.track,children:s.jsx("div",{ref:a,className:`${w.row} ${c?w.paused:""}`,children:i.map(({title:g,source:E},b)=>s.jsxs("a",{href:E,target:"_blank",rel:"noopener noreferrer",className:w.item,"aria-label":`Ouvrir: ${g} (nouvelle fen√™tre)`,title:g,draggable:!1,children:["¬´",g,"¬ª"]},b))})})}):s.jsx("p",{role:"status",children:"Aucun titre disponible."})}function q(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function Be(){q(),window.addEventListener("resize",q)}const He="_navButton_1c8qa_1",$e="_heading_1c8qa_12",Ge="_mainContent_1c8qa_23",Ke="_footer_1c8qa_33",A={navButton:He,heading:$e,mainContent:Ge,footer:Ke};function Xe(){return u.useEffect(()=>{Be()},[]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:A.header,children:[s.jsx("h1",{className:A.heading,children:"DevBarometer"}),s.jsx("a",{className:A.navButton,href:"https://github.com/clementvidon/devbarometer","aria-label":"Infos page",target:"_blank",rel:"noopener noreferrer",children:"√† propos"})]}),s.jsxs("main",{className:A.mainContent,children:[s.jsx(Ce,{}),s.jsx(qe,{}),s.jsx(be,{})]}),s.jsxs("footer",{className:A.footer,children:["Made with ‚ù§Ô∏è by",s.jsx("a",{href:"https://github.com/clementvidon/","aria-label":"Author's GitHub",target:"_blank",rel:"noopener noreferrer",children:" Cl√©ment Vidon "})]})]})}Q.createRoot(document.getElementById("root")).render(s.jsx(u.StrictMode,{children:s.jsx(Xe,{})}));
