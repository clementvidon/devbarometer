import{j as n,R as X,L as Y,C as U,X as z,Y as K,T as V,a as W,r as i,c as J}from"./vendor-uy8bHOC1.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const Q="_chartContainer_pk6j8_1",Z="_heading_pk6j8_17",ee="_chart_pk6j8_1",te="_chartFooter_pk6j8_40",re="_legendCol_pk6j8_58",ne="_controlCol_pk6j8_59",oe="_legendItem_pk6j8_71",se="_controlItem_pk6j8_72",ae="_colorDot_pk6j8_96",f={chartContainer:Q,heading:Z,chart:ee,chartFooter:te,legendCol:re,controlCol:ne,legendItem:oe,controlItem:se,colorDot:ae};function ie({view:t,onToggleView:o,hudVisible:e,onToggleHud:a}){return n.jsxs("div",{className:f.controlCol,children:[n.jsx("button",{type:"button",className:f.controlItem,onClick:o,children:t==="emotions"?"Voir tonalités 📈":"Voir émotions 📊"}),n.jsx("button",{type:"button",className:f.controlItem,"aria-pressed":e,onClick:a,title:e?"Masquer axes/valeurs":"Afficher axes/valeurs",children:e?"Masquer axes/valeurs ⚙️":"Afficher axes/valeurs ⚙️"}),n.jsx("button",{type:"button",className:f.controlItem,disabled:!0,title:"Rapport périodique — bientôt disponible",children:"S'abonner au rapport 📦"}),n.jsx("button",{type:"button",className:f.controlItem,disabled:!0,title:"Analyste interactif — bientôt disponible",children:"Parler à l'analyste 💬"})]})}const d={axisText:"#9ec3ff",axisLine:"#6b93c9",grid:"#2a4566",tooltipBg:"rgba(18, 34, 52, 0.96)",tooltipBorder:"#3a5f8f",tooltipText:"#dbeaff"},D={joy:"#B7C8FF",trust:"#B39EFF",fear:"#D00000",anger:"#D20054",disgust:"#7E0000",sadness:"#8B1F4D"},R=Object.keys(D),O={joy:"Joie",trust:"Confiance",fear:"Peur",anger:"Colère",disgust:"Dégoût",sadness:"Tristesse"},S={polarity:"#FF3385",surprise:"#EA80FF",anticipation:"#7728FF"},M=Object.keys(S),P={polarity:"Valence",surprise:"Surprise",anticipation:"Anticipation"},ce=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),q=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"}),T=new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2});function B({data:t,hudVisible:o,tooltipActive:e,setTooltipActive:a,series:s}){return n.jsx("div",{className:f.chart,onPointerDown:()=>a(!0),onPointerUp:()=>a(!1),onPointerCancel:()=>a(!1),onPointerLeave:()=>a(!1),children:n.jsx(X,{width:"100%",height:"100%",children:n.jsxs(Y,{data:t,children:[o&&n.jsx(U,{stroke:d.grid,strokeDasharray:"3 3",vertical:!1}),n.jsx(z,{dataKey:"createdAt",hide:!o,tick:{fill:d.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:d.axisLine},tickLine:{stroke:d.axisLine},tickFormatter:r=>ce.format(new Date(r)),tickMargin:10}),n.jsx(K,{tickFormatter:r=>T.format(r),tickMargin:5,width:50,hide:!o,tick:{fill:d.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:d.axisLine},tickLine:{stroke:d.axisLine},domain:["dataMin","dataMax"]}),n.jsx(V,{contentStyle:{backgroundColor:d.tooltipBg,border:`1px solid ${d.tooltipBorder}`,borderRadius:8},labelStyle:{color:d.tooltipText},itemStyle:{color:d.tooltipText},cursor:{stroke:d.axisLine,strokeDasharray:"3 3"},wrapperStyle:{display:e?"block":"none"},labelFormatter:r=>q.format(new Date(String(r))),formatter:(r,c)=>[T.format(r),c],itemSorter:r=>typeof r.value=="number"?-r.value:0}),s.map(r=>n.jsx(W,{type:"monotone",dataKey:r.key,stroke:r.color,strokeWidth:3,dot:!1,name:r.label??r.key,activeDot:e?{r:5}:!1},r.key))]})})})}function le(t){const o=R.map(e=>({key:e,color:D[e],label:O[e]}));return n.jsx(B,{...t,series:o})}function ue({mode:t="emotions"}){const o=t==="emotions"?R.map(e=>({key:String(e),color:D[e],label:O[e]})):M.map(e=>({key:String(e),color:S[e],label:P[e]}));return n.jsx("div",{className:f.legendCol,children:o.map(e=>n.jsxs("div",{className:f.legendItem,children:[n.jsx("span",{className:f.colorDot,style:{backgroundColor:e.color}}),n.jsx("span",{children:e.label})]},e.key))})}function de(t){const o=M.map(e=>({key:e,color:S[e],label:P[e]}));return n.jsx(B,{...t,series:o})}function fe(t){if(!t||typeof t!="object")return!1;const o=t;return typeof o.createdAt=="string"&&typeof o.emotions=="object"&&o.emotions!==null}function pe(t){if(!Array.isArray(t)||!t.every(fe))throw new Error("Invalid chart.json shape")}function me(t){const o=Object.keys(D);return t.slice().sort((e,a)=>+new Date(e.createdAt)-+new Date(a.createdAt)).map(e=>{const a={};for(const s of o)a[s]=+(e.emotions[s]??0);return{dateLabel:q.format(new Date(e.createdAt)),createdAt:e.createdAt,...a}})}function he(t){return t.slice().sort((o,e)=>+new Date(o.createdAt)-+new Date(e.createdAt)).map(o=>{const e=o.tonalities,a=(e==null?void 0:e.positive)??0,s=(e==null?void 0:e.negative)??0,r=(e==null?void 0:e.positive_surprise)??0,c=(e==null?void 0:e.negative_surprise)??0,p=(e==null?void 0:e.optimistic_anticipation)??0,x=(e==null?void 0:e.pessimistic_anticipation)??0;return{createdAt:o.createdAt,polarity:+(a-s),surprise:+(r-c),anticipation:+(p-x)}})}function ge(){const[t,o]=i.useState(null),[e,a]=i.useState(null),[s,r]=i.useState(null);return i.useEffect(()=>{(async()=>{try{const p=await(await fetch("chart.json")).json();pe(p),o(me(p)),a(he(p))}catch(c){r(c instanceof Error?c:new Error("Erreur inconnue")),o([]),a([])}})()},[]),{emotionData:t,tonalityData:e,isLoading:!t||!e,error:s}}function xe(){const{emotionData:t,tonalityData:o,isLoading:e,error:a}=ge(),[s,r]=i.useState("emotions"),[c,p]=i.useState(!1),[x,g]=i.useState(!1);if(e)return n.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du graphique…"});if(!t||!o)return n.jsx("p",{role:"alert","aria-live":"assertive",children:"Données manquantes ou invalides."});if(a)return n.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du graphique."});const m=(t==null?void 0:t.length)??0,j=()=>r(_=>_==="emotions"?"tonalities":"emotions");return n.jsxs("div",{className:f.chartContainer,children:[n.jsx("p",{className:f.heading,children:s==="emotions"?`Intensité des émotions – ${m} jours`:`Polarité des tonalités – ${m} jours`}),s==="emotions"?n.jsx(le,{data:t,hudVisible:c,tooltipActive:x,setTooltipActive:g}):n.jsx(de,{data:o,hudVisible:c,tooltipActive:x,setTooltipActive:g}),n.jsxs("div",{className:f.chartFooter,children:[n.jsx("div",{children:n.jsx(ue,{mode:s})}),n.jsx(ie,{view:s,onToggleView:j,hudVisible:c,onToggleHud:()=>p(_=>!_)})]})]})}const _e="_report_149pe_1",ye="_emoji_149pe_9",je="_text_149pe_15",I={report:_e,emoji:ye,text:je};function ve(){const[t,o]=i.useState(null),[e,a]=i.useState(null);return i.useEffect(()=>{fetch("/devbarometer/"+"report.json").then(r=>r.ok?r.json():null).then(r=>{if(r&&typeof r=="object")o(r);else throw new Error("Format de données invalide")}).catch(r=>{a(r instanceof Error?r:new Error("Erreur inconnue")),o(null)})},[]),{report:t,isLoading:t===null&&e===null,error:e}}function Ee(){const{report:t,isLoading:o,error:e}=ve();return o?n.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du rapport…"}):e||!t?n.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement du rapport."}):n.jsxs("div",{className:I.report,children:[n.jsx("div",{className:I.emoji,children:t.emoji}),n.jsx("p",{className:I.text,children:t.text})]})}const be="_ticker_ycql9_1",Le="_track_ycql9_20",ke="_dragging_ycql9_33",we="_row_ycql9_37",Ce="_paused_ycql9_44",De="_item_ycql9_48",E={ticker:be,track:Le,dragging:ke,row:we,paused:Ce,item:De};function Ae(t){return typeof t=="object"&&t!==null&&"title"in t&&"weight"in t&&"source"in t&&typeof t.title=="string"&&typeof t.weight=="string"&&typeof t.source=="string"}function Ie(t){const o=t.slice();for(let e=o.length-1;e>0;e--){const a=Math.floor(Math.random()*(e+1));[o[e],o[a]]=[o[a],o[e]]}return o}function Ne(){const[t,o]=i.useState(null),[e,a]=i.useState(null);return i.useEffect(()=>{fetch("/devbarometer/"+"ticker.json").then(r=>r.ok?r.json():[]).then(r=>{if(Array.isArray(r)&&r.every(Ae))o(Ie(r));else throw new Error("Format de données invalide")}).catch(r=>{a(r instanceof Error?r:new Error("Erreur inconnue")),o([])})},[]),{headlines:t,isLoading:t===null&&e===null,error:e}}function Se(t,o,{copies:e,onPause:a,onResume:s,pauseDelay:r=120}){const g=i.useRef(!1),m=i.useRef(!1),j=i.useRef(!1),_=i.useRef(0),C=i.useRef(0),v=i.useRef(null),h=()=>{const l=t.current,u=o.current;if(!l||!u)return;const A=u.scrollWidth/e;l.scrollLeft<24?l.scrollLeft+=A:l.scrollLeft>A*2-24&&(l.scrollLeft-=A)},b=l=>{l.scrollLeft+=.01,l.scrollLeft-=.01},L=i.useCallback(()=>{const l=t.current,u=o.current;if(!l||!u)return;const y=requestAnimationFrame(()=>{l.scrollLeft=u.scrollWidth/e});return()=>cancelAnimationFrame(y)},[e]),k=()=>{v.current!==null&&(window.clearTimeout(v.current),v.current=null)},H=i.useCallback(l=>{const u=t.current;if(!u)return;g.current=!0,m.current=!1,j.current=!1,_.current=l.clientX,C.current=u.scrollLeft,u.classList.add(E.dragging),k(),v.current=window.setTimeout(()=>{g.current&&!m.current&&a()},r);const y=()=>{g.current=!1,u.classList.remove(E.dragging),k(),h(),b(u),s(),window.removeEventListener("pointerup",y)};window.addEventListener("pointerup",y)},[t,a,s,r]),$=i.useCallback(l=>{const u=t.current;if(!u||!g.current)return;const y=l.clientX-_.current;!m.current&&Math.abs(y)>10&&(m.current=!0,j.current=!0,k(),a()),m.current&&(u.scrollLeft=C.current-y,h(),l.preventDefault())},[t,a]),G=i.useCallback(l=>{j.current&&(l.preventDefault(),l.stopPropagation())},[]);return{onPointerDown:H,onPointerMove:$,onClickCapture:G,placeInitialScroll:L}}const N=3;function Te(){const{headlines:t,isLoading:o,error:e}=Ne(),a=i.useRef(null),s=i.useRef(null),r=i.useMemo(()=>t??[],[t]),c=i.useMemo(()=>Array.from({length:N},()=>r).flat(),[r]),[p,x]=i.useState(!1),g=i.useCallback(()=>x(!0),[]),m=i.useCallback(()=>x(!1),[]),{onPointerDown:j,onPointerMove:_,onClickCapture:C,placeInitialScroll:v}=Se(a,s,{copies:N,onPause:g,onResume:m,pauseDelay:120});return i.useEffect(()=>{const h=a.current,b=s.current;if(!h||!b)return;const L=b.scrollWidth/N;Math.abs(h.scrollLeft-L)>2&&(h.scrollLeft=L)},[c.length]),i.useEffect(()=>v(),[c.length,v]),o?n.jsx("p",{role:"status","aria-live":"polite",children:"Chargement des titres…"}):e?n.jsx("p",{role:"alert","aria-live":"assertive",children:"Erreur de chargement."}):c.length?n.jsx("div",{className:E.ticker,onPointerDown:j,onPointerMove:_,onClickCapture:C,children:n.jsx("div",{ref:a,className:E.track,children:n.jsx("div",{ref:s,className:`${E.row} ${p?E.paused:""}`,children:c.map(({title:h,source:b,weight:L},k)=>n.jsxs("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:E.item,"aria-label":`Ouvrir: ${h} (nouvelle fenêtre)`,title:h,draggable:!1,children:["«",h,"» ⇧",L]},k))})})}):n.jsx("p",{role:"status",children:"Aucun titre disponible."})}function F(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function Fe(){F(),window.addEventListener("resize",F)}const Re="_navButton_1c8qa_1",Oe="_heading_1c8qa_12",Me="_mainContent_1c8qa_23",Pe="_footer_1c8qa_33",w={navButton:Re,heading:Oe,mainContent:Me,footer:Pe};function qe(){return i.useEffect(()=>{Fe()},[]),n.jsxs(n.Fragment,{children:[n.jsxs("header",{className:w.header,children:[n.jsx("h1",{className:w.heading,children:"DevBarometer"}),n.jsx("a",{className:w.navButton,href:"https://github.com/clementvidon/devbarometer","aria-label":"Infos page",target:"_blank",rel:"noopener noreferrer",children:"à propos"})]}),n.jsxs("main",{className:w.mainContent,children:[n.jsx(Ee,{}),n.jsx(Te,{}),n.jsx(xe,{})]}),n.jsxs("footer",{className:w.footer,children:["Made with ❤️ by",n.jsx("a",{href:"https://github.com/clementvidon/","aria-label":"Author's GitHub",target:"_blank",rel:"noopener noreferrer",children:" Clément Vidon "})]})]})}J.createRoot(document.getElementById("root")).render(n.jsx(i.StrictMode,{children:n.jsx(qe,{})}));
