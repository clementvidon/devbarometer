import{j as t,R as $,L as q,C as Y,X as U,Y as z,T as K,a as X,r as i,c as V}from"./vendor-uy8bHOC1.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();function N(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function W(){N(),window.addEventListener("resize",N)}function G(r){if(!r||typeof r!="object")return!1;const n=r;return typeof n.createdAt=="string"&&typeof n.emotions=="object"&&n.emotions!==null}function J(r){if(!Array.isArray(r)||!r.every(G))throw new Error("Invalid chart.json shape")}const Q="_chartContainer_pk6j8_1",Z="_heading_pk6j8_17",ee="_chart_pk6j8_1",te="_chartFooter_pk6j8_40",re="_legendCol_pk6j8_58",ne="_controlCol_pk6j8_59",oe="_legendItem_pk6j8_71",se="_controlItem_pk6j8_72",ae="_colorDot_pk6j8_96",f={chartContainer:Q,heading:Z,chart:ee,chartFooter:te,legendCol:re,controlCol:ne,legendItem:oe,controlItem:se,colorDot:ae};function ie({view:r,onToggleView:n,hudVisible:e,onToggleHud:s}){return t.jsxs("div",{className:f.controlCol,children:[t.jsx("button",{type:"button",className:f.controlItem,onClick:n,children:r==="emotions"?"Voir tonalités 📈":"Voir émotions 📊"}),t.jsx("button",{type:"button",className:f.controlItem,"aria-pressed":e,onClick:s,title:e?"Masquer axes/valeurs":"Afficher axes/valeurs",children:e?"Masquer axes/valeurs ⚙️":"Afficher axes/valeurs ⚙️"}),t.jsx("button",{type:"button",className:f.controlItem,disabled:!0,title:"Rapport périodique — bientôt disponible",children:"S'abonner au rapport 📦"})]})}const d={axisText:"#9ec3ff",axisLine:"#6b93c9",grid:"#2a4566",tooltipBg:"rgba(18, 34, 52, 0.96)",tooltipBorder:"#3a5f8f",tooltipText:"#dbeaff"},w={joy:"#B7C8FF",trust:"#B39EFF",fear:"#D00000",anger:"#D20054",disgust:"#7E0000",sadness:"#8B1F4D"},F=Object.keys(w),T={joy:"Joie",trust:"Confiance",fear:"Peur",anger:"Colère",disgust:"Dégoût",sadness:"Tristesse"},E={polarity:"#FF3385",surprise:"#EA80FF",anticipation:"#7728FF"},R=Object.keys(E),I={polarity:"Valence",surprise:"Surprise",anticipation:"Anticipation"},ce=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),O=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),S=new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2});function M({data:r,hudVisible:n,tooltipActive:e,setTooltipActive:s,series:a}){return t.jsx("div",{className:f.chart,onPointerDown:()=>s(!0),onPointerUp:()=>s(!1),onPointerCancel:()=>s(!1),onPointerLeave:()=>s(!1),children:t.jsx($,{width:"100%",height:"100%",children:t.jsxs(q,{data:r,children:[n&&t.jsx(Y,{stroke:d.grid,strokeDasharray:"3 3",vertical:!1}),t.jsx(U,{dataKey:"createdAt",hide:!n,tick:{fill:d.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:d.axisLine},tickLine:{stroke:d.axisLine},tickFormatter:o=>ce.format(new Date(o)),tickMargin:10}),t.jsx(z,{tickFormatter:o=>S.format(o),tickMargin:5,width:50,hide:!n,tick:{fill:d.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:d.axisLine},tickLine:{stroke:d.axisLine},domain:["dataMin","dataMax"]}),t.jsx(K,{contentStyle:{backgroundColor:d.tooltipBg,border:`1px solid ${d.tooltipBorder}`,borderRadius:8},labelStyle:{color:d.tooltipText},itemStyle:{color:d.tooltipText},cursor:{stroke:d.axisLine,strokeDasharray:"3 3"},wrapperStyle:{display:e?"block":"none"},labelFormatter:o=>O.format(new Date(String(o))),formatter:(o,u)=>[S.format(o),u],itemSorter:o=>typeof o.value=="number"?-o.value:0}),a.map(o=>t.jsx(X,{type:"monotone",dataKey:o.key,stroke:o.color,strokeWidth:3,dot:!1,name:o.label??o.key,activeDot:e?{r:5}:!1},o.key))]})})})}function le(r){const n=F.map(e=>({key:e,color:w[e],label:T[e]}));return t.jsx(M,{...r,series:n})}function ue({mode:r="emotions"}){const n=r==="emotions"?F.map(e=>({key:String(e),color:w[e],label:T[e]})):R.map(e=>({key:String(e),color:E[e],label:I[e]}));return t.jsx("div",{className:f.legendCol,children:n.map(e=>t.jsxs("div",{className:f.legendItem,children:[t.jsx("span",{className:f.colorDot,style:{backgroundColor:e.color}}),t.jsx("span",{children:e.label})]},e.key))})}function de(r){const n=R.map(e=>({key:e,color:E[e],label:I[e]}));return t.jsx(M,{...r,series:n})}function fe(r){const n=Object.keys(w);return r.slice().sort((e,s)=>+new Date(e.createdAt)-+new Date(s.createdAt)).map(e=>{const s={};for(const a of n)s[a]=+(e.emotions[a]??0);return{dateLabel:O.format(new Date(e.createdAt)),createdAt:e.createdAt,...s}})}function me(r){return r.slice().sort((n,e)=>+new Date(n.createdAt)-+new Date(e.createdAt)).map(n=>{const e=n.tonalities,s=(e==null?void 0:e.positive)??0,a=(e==null?void 0:e.negative)??0,o=(e==null?void 0:e.positive_surprise)??0,u=(e==null?void 0:e.negative_surprise)??0,h=(e==null?void 0:e.optimistic_anticipation)??0,g=(e==null?void 0:e.pessimistic_anticipation)??0;return{createdAt:n.createdAt,polarity:+(s-a),surprise:+(o-u),anticipation:+(h-g)}})}function pe(){const[r,n]=i.useState(null),[e,s]=i.useState(null),[a,o]=i.useState("emotions"),[u,h]=i.useState(!1),[g,y]=i.useState(!1);i.useEffect(()=>{(async()=>{try{const k=await(await fetch("chart.json")).json();J(k);const L=k;n(fe(L)),s(me(L))}catch(p){console.error("Erreur lors du chargement des données:",p),n([]),s([])}})()},[]);const j=(r==null?void 0:r.length)??0;if(!r||!e)return t.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du graphique…"});const v=()=>o(p=>p==="emotions"?"tonalities":"emotions");return t.jsxs("div",{className:f.chartContainer,children:[t.jsx("p",{className:f.heading,children:a==="emotions"?`Intensité des émotions – ${j} jours.`:`Polarité des tonalités – ${j} jours.`}),a==="emotions"?t.jsx(le,{data:r,hudVisible:u,tooltipActive:g,setTooltipActive:y}):t.jsx(de,{data:e,hudVisible:u,tooltipActive:g,setTooltipActive:y}),t.jsxs("div",{className:f.chartFooter,children:[t.jsx("div",{children:t.jsx(ue,{mode:a})}),t.jsx(ie,{view:a,onToggleView:v,hudVisible:u,onToggleHud:()=>h(p=>!p)})]})]})}const he="_report_149pe_1",ge="_emoji_149pe_9",xe="_text_149pe_15",A={report:he,emoji:ge,text:xe};function _e(){const[r,n]=i.useState(null);return i.useEffect(()=>{fetch("/devbarometer/"+"report.json").then(s=>s.ok?s.json():null).then(s=>{n(s&&typeof s=="object"?s:null)})},[]),r?t.jsxs("div",{className:A.report,children:[t.jsx("div",{className:A.emoji,children:r.emoji}),t.jsx("p",{className:A.text,children:r.text})]}):t.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du rapport…"})}function je(r){return typeof r=="object"&&r!==null&&"title"in r&&"weight"in r&&"source"in r&&typeof r.title=="string"&&typeof r.weight=="number"&&typeof r.source=="string"}function ye(r){const n=r.slice();for(let e=n.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[n[e],n[s]]=[n[s],n[e]]}return n}const ve="_ticker_1n7r0_1",ke="_track_1n7r0_17",be="_dragging_1n7r0_29",Le="_row_1n7r0_33",we="_noAnim_1n7r0_48",Ae="_item_1n7r0_53",_={ticker:ve,track:ke,dragging:be,row:Le,noAnim:we,item:Ae},C=3,Ce=10,Ee=5e3;function De(){const[r,n]=i.useState(null),e=i.useRef(null),s=i.useRef(null),a=i.useRef(!1),o=i.useRef(!1),u=i.useRef(!1),h=i.useRef(!1),g=i.useRef(0),y=i.useRef(0),j=i.useRef(null),v=i.useMemo(()=>r?ye(r):[],[r]),p=i.useMemo(()=>v.length?Array.from({length:C},()=>v).flat():[],[v]);i.useEffect(()=>{fetch("/devbarometer/"+"ticker.json").then(c=>c.ok?c.json():[]).then(c=>{Array.isArray(c)&&c.every(je)?n(c):n([])}).catch(()=>n([]))},[]),i.useEffect(()=>{const l=e.current,c=s.current;if(!l||!c)return;const m=requestAnimationFrame(()=>{const x=c.scrollWidth/C;l.scrollLeft=x});return()=>cancelAnimationFrame(m)},[p.length]);const k=()=>{const l=e.current,c=s.current;if(!l||!c)return;const x=c.scrollWidth/C,D=24;l.scrollLeft<D?l.scrollLeft+=x:l.scrollLeft>x*2-D&&(l.scrollLeft-=x)},L=()=>{j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{h.current=!1},Ee)},B=l=>{const c=e.current;if(!c)return;a.current=!0,o.current=!1,u.current=!1,g.current=l.clientX,y.current=c.scrollLeft,c.classList.add(_.dragging);const m=()=>{a.current=!1,o.current=!1,c.classList.remove(_.dragging),k(),window.removeEventListener("pointerup",m),L()};window.addEventListener("pointerup",m)},P=l=>{const c=e.current;if(!c||!a.current)return;const m=l.clientX-g.current;!o.current&&Math.abs(m)>Ce&&(o.current=!0,u.current=!0,h.current=!0),o.current&&(c.scrollLeft=y.current-m,k(),l.preventDefault())},H=l=>{u.current&&(l.preventDefault(),l.stopPropagation())};return r===null?t.jsx("p",{role:"status","aria-live":"polite",children:"Chargement des titres…"}):r.length===0?t.jsx("p",{role:"status","aria-live":"polite",children:"Aucun titre chargé."}):t.jsx("div",{className:_.ticker,onPointerDown:B,onPointerMove:P,onClickCapture:H,children:t.jsx("div",{ref:e,className:_.track,children:t.jsx("div",{ref:s,className:`${_.row} ${h.current?_.noAnim:""}`,children:p.map(({title:l,source:c,weight:m},x)=>t.jsxs("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:_.item,"aria-label":`Source: ${l}`,title:l,draggable:!1,children:["«",l,"» ⇧",m]},x))})})})}const Ne="_navButton_1c8qa_1",Se="_heading_1c8qa_12",Fe="_mainContent_1c8qa_23",Te="_footer_1c8qa_33",b={navButton:Ne,heading:Se,mainContent:Fe,footer:Te};function Re(){return t.jsxs(t.Fragment,{children:[t.jsxs("header",{className:b.header,children:[t.jsx("h1",{className:b.heading,children:"DevBarometer"}),t.jsx("a",{className:b.navButton,href:"https://github.com/clementvidon/devbarometer","aria-label":"Infos page",target:"_blank",rel:"noopener noreferrer",children:"à propos"})]}),t.jsxs("main",{className:b.mainContent,children:[t.jsx(_e,{}),t.jsx(De,{}),t.jsx(pe,{})]}),t.jsxs("footer",{className:b.footer,children:["Made with ❤️ by",t.jsx("a",{href:"https://github.com/clementvidon/","aria-label":"Author's GitHub",target:"_blank",rel:"noopener noreferrer",children:" Clément Vidon "}),"· MIT License"]})]})}W();V.createRoot(document.getElementById("root")).render(t.jsx(i.StrictMode,{children:t.jsx(Re,{})}));
