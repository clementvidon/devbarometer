import{j as t,R as P,L as H,C as $,X as q,Y,T as U,a as z,r as c,c as K}from"./vendor-uy8bHOC1.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();function N(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function X(){N(),window.addEventListener("resize",N)}function V(r){if(!r||typeof r!="object")return!1;const n=r;return typeof n.createdAt=="string"&&typeof n.emotions=="object"&&n.emotions!==null}function W(r){if(!Array.isArray(r)||!r.every(V))throw new Error("Invalid chart.json shape")}const G="_chartContainer_pk6j8_1",J="_heading_pk6j8_17",Q="_chart_pk6j8_1",Z="_chartFooter_pk6j8_40",ee="_legendCol_pk6j8_58",te="_controlCol_pk6j8_59",re="_legendItem_pk6j8_71",ne="_controlItem_pk6j8_72",oe="_colorDot_pk6j8_96",f={chartContainer:G,heading:J,chart:Q,chartFooter:Z,legendCol:ee,controlCol:te,legendItem:re,controlItem:ne,colorDot:oe};function se({view:r,onToggleView:n,hudVisible:e,onToggleHud:s}){return t.jsxs("div",{className:f.controlCol,children:[t.jsx("button",{type:"button",className:f.controlItem,onClick:n,children:r==="emotions"?"Voir tonalités 📈":"Voir émotions 📊"}),t.jsx("button",{type:"button",className:f.controlItem,"aria-pressed":e,onClick:s,title:e?"Masquer axes/valeurs":"Afficher axes/valeurs",children:e?"Masquer axes/valeurs ⚙️":"Afficher axes/valeurs ⚙️"}),t.jsx("button",{type:"button",className:f.controlItem,disabled:!0,title:"Rapport périodique — bientôt disponible",children:"S'abonner au rapport 📦"})]})}const d={axisText:"#9ec3ff",axisLine:"#6b93c9",grid:"#2a4566",tooltipBg:"rgba(18, 34, 52, 0.96)",tooltipBorder:"#3a5f8f",tooltipText:"#dbeaff"},C={joy:"#B7C8FF",trust:"#B39EFF",fear:"#D00000",anger:"#D20054",disgust:"#7E0000",sadness:"#8B1F4D"},F=Object.keys(C),I={joy:"Joie",trust:"Confiance",fear:"Peur",anger:"Colère",disgust:"Dégoût",sadness:"Tristesse"},E={polarity:"#FF3385",surprise:"#EA80FF",anticipation:"#7728FF"},T=Object.keys(E),R={polarity:"Valence",surprise:"Surprise",anticipation:"Anticipation"},ae=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),O=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),S=new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2});function M({data:r,hudVisible:n,tooltipActive:e,setTooltipActive:s,series:a}){return t.jsx("div",{className:f.chart,onPointerDown:()=>s(!0),onPointerUp:()=>s(!1),onPointerCancel:()=>s(!1),onPointerLeave:()=>s(!1),children:t.jsx(P,{width:"100%",height:"100%",children:t.jsxs(H,{data:r,children:[n&&t.jsx($,{stroke:d.grid,strokeDasharray:"3 3",vertical:!1}),t.jsx(q,{dataKey:"createdAt",hide:!n,tick:{fill:d.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:d.axisLine},tickLine:{stroke:d.axisLine},tickFormatter:o=>ae.format(new Date(o)),tickMargin:10}),t.jsx(Y,{tickFormatter:o=>S.format(o),tickMargin:5,width:50,hide:!n,tick:{fill:d.axisText,fontSize:"var(--font-size-content)"},axisLine:{stroke:d.axisLine},tickLine:{stroke:d.axisLine},domain:["dataMin","dataMax"]}),t.jsx(U,{contentStyle:{backgroundColor:d.tooltipBg,border:`1px solid ${d.tooltipBorder}`,borderRadius:8},labelStyle:{color:d.tooltipText},itemStyle:{color:d.tooltipText},cursor:{stroke:d.axisLine,strokeDasharray:"3 3"},wrapperStyle:{display:e?"block":"none"},labelFormatter:o=>O.format(new Date(String(o))),formatter:(o,u)=>[S.format(o),u],itemSorter:o=>typeof o.value=="number"?-o.value:0}),a.map(o=>t.jsx(z,{type:"monotone",dataKey:o.key,stroke:o.color,strokeWidth:3,dot:!1,name:o.label??o.key,activeDot:e?{r:5}:!1},o.key))]})})})}function ie(r){const n=F.map(e=>({key:e,color:C[e],label:I[e]}));return t.jsx(M,{...r,series:n})}function ce({mode:r="emotions"}){const n=r==="emotions"?F.map(e=>({key:String(e),color:C[e],label:I[e]})):T.map(e=>({key:String(e),color:E[e],label:R[e]}));return t.jsx("div",{className:f.legendCol,children:n.map(e=>t.jsxs("div",{className:f.legendItem,children:[t.jsx("span",{className:f.colorDot,style:{backgroundColor:e.color}}),t.jsx("span",{children:e.label})]},e.key))})}function le(r){const n=T.map(e=>({key:e,color:E[e],label:R[e]}));return t.jsx(M,{...r,series:n})}function ue(r){const n=Object.keys(C);return r.slice().sort((e,s)=>+new Date(e.createdAt)-+new Date(s.createdAt)).map(e=>{const s={};for(const a of n)s[a]=+(e.emotions[a]??0);return{dateLabel:O.format(new Date(e.createdAt)),createdAt:e.createdAt,...s}})}function de(r){return r.slice().sort((n,e)=>+new Date(n.createdAt)-+new Date(e.createdAt)).map(n=>{const e=n.tonalities,s=(e==null?void 0:e.positive)??0,a=(e==null?void 0:e.negative)??0,o=(e==null?void 0:e.positive_surprise)??0,u=(e==null?void 0:e.negative_surprise)??0,g=(e==null?void 0:e.optimistic_anticipation)??0,x=(e==null?void 0:e.pessimistic_anticipation)??0;return{createdAt:n.createdAt,polarity:+(s-a),surprise:+(o-u),anticipation:+(g-x)}})}function fe(){const[r,n]=c.useState(null),[e,s]=c.useState(null),[a,o]=c.useState("emotions"),[u,g]=c.useState(!1),[x,y]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const L=await(await fetch("chart.json")).json();W(L);const w=L;n(ue(w)),s(de(w))}catch(m){console.error("Erreur lors du chargement des données:",m),n([]),s([])}})()},[]);const j=(r==null?void 0:r.length)??0;if(!r||!e)return t.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du graphique…"});const b=()=>o(m=>m==="emotions"?"tonalities":"emotions");return t.jsxs("div",{className:f.chartContainer,children:[t.jsx("p",{className:f.heading,children:a==="emotions"?`Intensité des émotions – ${j} jours.`:`Polarité des tonalités – ${j} jours.`}),a==="emotions"?t.jsx(ie,{data:r,hudVisible:u,tooltipActive:x,setTooltipActive:y}):t.jsx(le,{data:e,hudVisible:u,tooltipActive:x,setTooltipActive:y}),t.jsxs("div",{className:f.chartFooter,children:[t.jsx("div",{children:t.jsx(ce,{mode:a})}),t.jsx(se,{view:a,onToggleView:b,hudVisible:u,onToggleHud:()=>g(m=>!m)})]})]})}const pe="_report_149pe_1",me="_emoji_149pe_9",he="_text_149pe_15",A={report:pe,emoji:me,text:he};function ge(){const[r,n]=c.useState(null);return c.useEffect(()=>{fetch("/devbarometer/"+"report.json").then(s=>s.ok?s.json():null).then(s=>{n(s&&typeof s=="object"?s:null)})},[]),r?t.jsxs("div",{className:A.report,children:[t.jsx("div",{className:A.emoji,children:r.emoji}),t.jsx("p",{className:A.text,children:r.text})]}):t.jsx("p",{role:"status","aria-live":"polite",children:"Chargement du rapport…"})}function xe(r){return typeof r=="object"&&r!==null&&"title"in r&&"weight"in r&&"source"in r&&typeof r.title=="string"&&typeof r.weight=="number"&&typeof r.source=="string"}function _e(r){const n=r.slice();for(let e=n.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[n[e],n[s]]=[n[s],n[e]]}return n}const je="_ticker_1dnru_1",ye="_track_1dnru_17",ve="_dragging_1dnru_29",ke="_row_1dnru_33",be="_noAnim_1dnru_48",Le="_item_1dnru_53",_={ticker:je,track:ye,dragging:ve,row:ke,noAnim:be,item:Le},D=3,we=10;function Ce(){const[r,n]=c.useState(null),e=c.useRef(null),s=c.useRef(null),a=c.useRef(!1),o=c.useRef(!1),u=c.useRef(!1),g=c.useRef(!1),x=c.useRef(0),y=c.useRef(0),j=c.useMemo(()=>r?_e(r):[],[r]),b=c.useMemo(()=>j.length?Array.from({length:D},()=>j).flat():[],[j]);c.useEffect(()=>{fetch("/devbarometer/"+"ticker.json").then(i=>i.ok?i.json():[]).then(i=>{Array.isArray(i)&&i.every(xe)?n(i):n([])}).catch(()=>n([]))},[]),c.useEffect(()=>{const l=e.current,i=s.current;if(!l||!i)return;const p=requestAnimationFrame(()=>{const h=i.scrollWidth/D;l.scrollLeft=h});return()=>cancelAnimationFrame(p)},[b.length]);const m=()=>{const l=e.current,i=s.current;if(!l||!i)return;const h=i.scrollWidth/D,v=24;l.scrollLeft<v?l.scrollLeft+=h:l.scrollLeft>h*2-v&&(l.scrollLeft-=h)},L=l=>{const i=e.current;if(!i)return;a.current=!0,o.current=!1,u.current=!1,x.current=l.clientX,y.current=i.scrollLeft,i.classList.add(_.dragging);const p=()=>{a.current=!1,o.current=!1,i.classList.remove(_.dragging),m(),window.removeEventListener("pointerup",p);function h(v){v.scrollLeft+=.01,v.scrollLeft-=.01}h(i),g.current=!1};window.addEventListener("pointerup",p)},w=l=>{const i=e.current;if(!i||!a.current)return;const p=l.clientX-x.current;!o.current&&Math.abs(p)>we&&(o.current=!0,u.current=!0,g.current=!0),o.current&&(i.scrollLeft=y.current-p,m(),l.preventDefault())},B=l=>{u.current&&(l.preventDefault(),l.stopPropagation())};return r===null?t.jsx("p",{role:"status","aria-live":"polite",children:"Chargement des titres…"}):r.length===0?t.jsx("p",{role:"status","aria-live":"polite",children:"Aucun titre chargé."}):t.jsx("div",{className:_.ticker,onPointerDown:L,onPointerMove:w,onClickCapture:B,children:t.jsx("div",{ref:e,className:_.track,children:t.jsx("div",{ref:s,className:`${_.row} ${g.current?_.noAnim:""}`,children:b.map(({title:l,source:i,weight:p},h)=>t.jsxs("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:_.item,"aria-label":`Source: ${l}`,title:l,draggable:!1,children:["«",l,"» ⇧",p]},h))})})})}const Ae="_navButton_1c8qa_1",De="_heading_1c8qa_12",Ee="_mainContent_1c8qa_23",Ne="_footer_1c8qa_33",k={navButton:Ae,heading:De,mainContent:Ee,footer:Ne};function Se(){return t.jsxs(t.Fragment,{children:[t.jsxs("header",{className:k.header,children:[t.jsx("h1",{className:k.heading,children:"DevBarometer"}),t.jsx("a",{className:k.navButton,href:"https://github.com/clementvidon/devbarometer","aria-label":"Infos page",target:"_blank",rel:"noopener noreferrer",children:"à propos"})]}),t.jsxs("main",{className:k.mainContent,children:[t.jsx(ge,{}),t.jsx(Ce,{}),t.jsx(fe,{})]}),t.jsxs("footer",{className:k.footer,children:["Made with ❤️ by",t.jsx("a",{href:"https://github.com/clementvidon/","aria-label":"Author's GitHub",target:"_blank",rel:"noopener noreferrer",children:" Clément Vidon "}),"· MIT License"]})]})}X();K.createRoot(document.getElementById("root")).render(t.jsx(c.StrictMode,{children:t.jsx(Se,{})}));
